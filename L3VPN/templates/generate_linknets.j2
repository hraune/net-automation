---
# List of available ipv4 networks that we can pull linknets(/30) from.
# Could put this in a separate place that we can import from, and export
# revised networks to after we have taken needed networks.
linknet:
  # Size of linknets
  size: {{ linknet.size }}
  # List of linknets generated, will be updated if fabrict is updated
  fabric_linknets:
{% if linknet.available_subnets|length > 0 %}
{% if not linknet.fabric_linknets %}
{##}{% for existing in linknet.fabric_linknets  %}
{##}{##}{% if linknets|length < fabric|length %}
    - {{ existing }}
{##}{##}{% endif %}
{##}{% endfor %}
{% endif %}
{##}{% for subnet in linknet.available_subnets %}
{##}{##}{% for i in range(subnet|ipsubnet(linknet.size)|int) %}
{##}{##}{##}{% if linknets|length < fabric|length %}
{##}{##}{##}{##}{% do linknets.append(subnet|ipsubnet(linknet.size,i)) %}
    - {{ subnet|ipsubnet(linknet.size,i) }}
{##}{##}{##}{% endif %}
{##}{##}{% endfor %}
{##}{% endfor %}
{% endif %}
  # List of available subnets to pull linknets from
  available_subnets:
{% if linknet.available_subnets|length > 0 %}
{##}{% for subnet in linknet.available_subnets %}
{##}{##}{% set new_subnets = subnet|subtract_subnet(linknets) %}
{##}{##}{% for new_subnet in new_subnets %}
    - {{ new_subnet }}
{##}{##}{% endfor %}
{##}{% endfor %}
{% endif %}
