---
# Node specific config


# P1

hostname P1


## Interface config

interface Loopback0
 ip address 10.2.2.2 255.255.255.255
 ip ospf 1 area 0
!
interface GigabitEthernet2
 description To PE1;Gi1
 ip address 10.203.55.2 255.255.255.252
 ip ospf 1 area 0
!
interface GigabitEthernet1
 description To PE2;Gi2
 ip address 10.203.55.5 255.255.255.252
 ip ospf 1 area 0
!


## Router config

router ospf 1
 mpls ldp autoconfig
!

!

!!!!

# PE1

hostname PE1


## Interface config

interface Loopback0
 ip address 10.1.1.1 255.255.255.255
 ip ospf 1 area 0
!
interface GigabitEthernet1
 description To P1;Gi2
 ip address 10.203.55.1 255.255.255.252
 ip ospf 1 area 0
!
interface GigabitEthernet2
 description To CE1;Gi1
 ip vrf forwarding RED
 ip address 10.203.55.10 255.255.255.252
 ip ospf 10 area 0
!
interface GigabitEthernet4
 description To CE3;Gi1
 ip vrf forwarding BLUE
 ip address 10.203.55.18 255.255.255.252
 ip ospf 20 area 0
!


## Router config

router ospf 1
 mpls ldp autoconfig
!
router ospf 10 vrf RED
 redistribute bgp 65001 subnets
!
router ospf 20 vrf BLUE
 redistribute bgp 65001 subnets
!

router bgp 65001
 bgp log-neighbor-changes
 neighbor 10.3.3.3 remote-as 65001
 neighbor 10.3.3.3 update-source Loopback0
 !
 address-family vpnv4
 neighbor 10.3.3.3 activate
 neighbor 10.3.3.3 send-community extended
 exit-address-family
 !
 address-family ipv4 vrf RED
  redistribute ospf 10
 exit-address-family
 !
 address-family ipv4 vrf BLUE
  redistribute ospf 20
 exit-address-family
 !
!


## VRF config

ip vrf RED
 rd: 65001:1
 route-target export 65001:1
 route-target import 65001:1
ip vrf BLUE
 rd: 65001:2
 route-target export 65001:2
 route-target import 65001:2

!!!!

# PE2

hostname PE2


## Interface config

interface Loopback0
 ip address 10.3.3.3 255.255.255.255
 ip ospf 1 area 0
!
interface GigabitEthernet2
 description To P1;Gi1
 ip address 10.203.55.6 255.255.255.252
 ip ospf 1 area 0
!
interface GigabitEthernet1
 description To CE2;Gi2
 ip vrf forwarding RED
 ip address 10.203.55.13 255.255.255.252
 ip ospf 10 area 0
!
interface GigabitEthernet4
 description To CE4;Gi2
 ip vrf forwarding BLUE
 ip address 10.203.55.129 255.255.255.252
 ip ospf 20 area 0
!


## Router config

router ospf 1
 mpls ldp autoconfig
!
router ospf 10 vrf RED
 redistribute bgp 65001 subnets
!
router ospf 20 vrf BLUE
 redistribute bgp 65001 subnets
!

router bgp 65001
 bgp log-neighbor-changes
 neighbor 10.1.1.1 remote-as 65001
 neighbor 10.1.1.1 update-source Loopback0
 !
 address-family vpnv4
 neighbor 10.1.1.1 activate
 neighbor 10.1.1.1 send-community extended
 exit-address-family
 !
 address-family ipv4 vrf RED
  redistribute ospf 10
 exit-address-family
 !
 address-family ipv4 vrf BLUE
  redistribute ospf 20
 exit-address-family
 !
!


## VRF config

ip vrf RED
 rd: 65001:1
 route-target export 65001:1
 route-target import 65001:1
ip vrf BLUE
 rd: 65001:2
 route-target export 65001:2
 route-target import 65001:2

!!!!

# CE1

hostname CE1


## Interface config

interface Loopback0
 ip address 172.16.1.1 255.255.255.255
 ip ospf 10 area 0
!
interface GigabitEthernet1
 description To PE1;Gi2
 ip address 10.203.55.9 255.255.255.252
 ip ospf 10 area 0
!


## Router config

router ospf 10
!

!

!!!!

# CE2

hostname CE2


## Interface config

interface Loopback0
 ip address 172.16.2.2 255.255.255.255
 ip ospf 10 area 0
!
interface GigabitEthernet2
 description To PE2;Gi1
 ip address 10.203.55.14 255.255.255.252
 ip ospf 10 area 0
!


## Router config

router ospf 10
!

!

!!!!

# CE3

hostname CE3


## Interface config

interface Loopback0
 ip address 172.16.3.3 255.255.255.255
 ip ospf 20 area 0
!
interface GigabitEthernet1
 description To PE1;Gi4
 ip address 10.203.55.17 255.255.255.252
 ip ospf 20 area 0
!


## Router config

router ospf 20
!

!

!!!!

# CE4

hostname CE4


## Interface config

interface Loopback0
 ip address 172.16.4.4 255.255.255.255
 ip ospf 20 area 0
!
interface GigabitEthernet2
 description To PE2;Gi4
 ip address 10.203.55.130 255.255.255.252
 ip ospf 20 area 0
!


## Router config

router ospf 20
!

!

!!!!
