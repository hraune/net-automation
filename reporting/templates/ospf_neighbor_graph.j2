graph ospf {
{% with vectors = [] %}
{% for host in ansible_play_hosts %}
{##}{% for neighbor in hostvars[host]['ospf_neighbor'] %}
{##}{##}{% set neighbors = (neighbor['NEIGHBOR_ID'],hostvars[host]['ospf_id']) %}
{##}{##}{% if not (neighbors in vectors or neighbors[::-1] in vectors) %}
{##}{##}{##}{% do vectors.append(neighbors) %}
    "{{ neighbors[0] }}" -- "{{ neighbors[1] }}"
{##}{##}{% endif %}
{##}{% endfor %}
{% endfor %}
###
{% do vectors = vectors|balance_graph() %}
{% for vector in vectors %}
    "{{ vector[0] }}" -- "{{ vector[1] }}"
{%endfor%}
{% endwith %}
    }